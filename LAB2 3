// Exercise 3: Timer1 Compare Match A Interrupt (Toggle LED every 1s)

#define F_CPU 16000000UL
#include <avr/io.h>
#include <avr/interrupt.h>

// Interrupt Service Routine for Timer1 Compare Match A
ISR(TIMER1_COMPA_vect) {
    PORTB ^= (1 << PORTB5);   // Toggle LED on PB5 (Arduino pin 13)
}

int main(void) {
    // ----- Setup -----
    DDRB |= (1 << DDB5);      // PB5 as output (LED pin)

    // ----- Configure Timer1 -----
    // Mode: CTC (Clear Timer on Compare Match)
    // Prescaler: 1024
    // Compare value: 15625 for 1 second at 16 MHz clock
    TCCR1B = (1 << WGM12) | (1 << CS12) | (1 << CS10);  // CTC mode, prescaler 1024
    OCR1A = 15625;            // Compare match value for 1 Hz

    // Enable Timer1 Compare Match A interrupt
    TIMSK1 = (1 << OCIE1A);

    // Clear interrupt flag (optional safety)
    TIFR1 |= (1 << OCF1A);

    // Enable global interrupts
    sei();

    // ----- Main Loop -----
    while (1) {
        // LED toggling handled by ISR
    }
}
